define("drawing.view",["app","ajax","util","appData"],function(e,t,n,r){return e.controller("DrawingViewCtrl",["$scope","$element","$location",function(i,s,o){function l(){a.css("display","block"),a.addClass("in")}function c(){a.removeClass("in").one("bsTransitionEnd",function(){a.css("display","none")}).emulateTransitionEnd(150)}function h(e){switch(e){case"js":return"技术部";case"sw":return"商务部";case"xmjl":return"项目经理";case"xmgl":return"项目管理";case"zt":return"制图部"}}var u={id:0};if(!o.$$search.id){$("#gos-btnHome").trigger("click");return}t.NewClient("/api/open").send("drawing.app.ItemViewData",{id:o.$$search.id}).done(function(t){var s=n.objectFind("id",parseInt(t.project_id),r.projects);t.project_name=s?s.name:"not found";var o=n.objectFind("id",parseInt(t.subject_id),r.subjects);t.subject_name=o?o.name:"not found",t.created=n.date2str(t.created,"time"),t.xmjl_sign_at_string=n.date2str(t.xmjl_sign_at,"time"),t.xmgl_sign_at_string=n.date2str(t.xmgl_sign_at,"time"),t.js_sign_at_string=n.date2str(t.js_sign_at,"time"),t.sw_sign_at_string=n.date2str(t.sw_sign_at,"time"),t.zt_sign_at_string=n.date2str(t.zt_sign_at,"time"),t.xmjl_user=n.objectFind("id",t.xmjl_id,r.all_users),t.js_user=n.objectFind("id",t.js_sign_by,r.all_users),t.zt_user=n.objectFind("id",t.zt_sign_by,r.all_users),t.xmgl_user=n.objectFind("id",t.xmgl_sign_by,r.all_users),t.sw_user=n.objectFind("id",t.sw_sign_by,r.all_users),i.$apply(function(){i.formData=t,i.currentUser=r.user,i.isCurrentUser=r.user.id==t.user_id,i.activeData=n.drawingActiveStatus(t,r)}),e.setTitle("晒图 "+t.name)}).fail(function(e){var t=JSON.parse(e.responseText);alert(t.message),$("#gos-btnHome").trigger("click")});var a=s.find("#draw-sign-dialog"),f=a.find("button.btn-primary");i.showDialog=function(e){i.currentSignTitle=h(e),i.currentType=e,a.find("button.btn-primary").data("typ",e),l()},f.click(function(){var e=f.data("typ"),t=0;e=="zt"&&(t=a.find("select").val()),i.sign(f.data("typ"),!0,t).done(function(){c()})}),f.prev().click(function(){c()}),i.sign=function(e,s,o){return t.NewClient("/api/open").button(f).send("drawing.app.DoSign",{item_id:i.formData.id,sign:s,typ:e,day:o}).done(function(t){if(!t)return;i.$apply(function(){i.activeData["finish_"+e]=s,s?(i.formData[e+"_user"]=r.user,i.formData[e+"_sign_by"]=r.user.id,i.formData[e+"_sign_at_string"]=n.date2str(new Date,"time")):(i.formData[e+"_user"]=null,i.formData[e+"_sign_by"]=0,i.formData[e+"_sign_at_string"]=null)})})}}]),{title:"晒图表单",goBackButton:!0,headerHtml:"",i18n:!1}});